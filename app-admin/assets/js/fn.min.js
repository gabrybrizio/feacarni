axios.defaults.headers.post["X-Requested-With"]="XMLHttpRequest";var richtext_selection,date_focus,UTIL=function(){var e={},t={};return e.init=function(e){let n={csrf:""};t=Object.assign({},n,e)},e.rnd=function(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e},e.csrf=function(){return t.csrf},e}(),STRING=function(){var e={clean:function(e){return e=e.trim(),e=e.replace(/\s\s+/g," "),e=e.replace(/\r?\n|\r/g," "),e},pad:function(e,t,n){var r=void 0!==n?n:"0",o=new Array(1+t).join(r);return(o+e).slice(-o.length)},slug:function(e){e=e.replace(/^\s+|\s+$/g,""),e=e.toLowerCase();for(var t="àáãäâèéëêìíïîòóöôùúüûñç·/_,:;’'",n="aaaaaeeeeiiiioooouuuunc--------",r=0,o=t.length;r<o;r++)e=e.replace(new RegExp(t.charAt(r),"g"),n.charAt(r));return e=e.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-"),e}};return e}(),ARRAY=function(){var e={unique:function(e){for(e=e.sort(),i=0;i<e.length;)e[i]==e[i+1]&&(e.splice(i,1),i--),i++;return e},shuffle:function(e){for(var t,n,r=e.length;r;t=parseInt(Math.random()*r),n=e[--r],e[r]=e[t],e[t]=n);return e},remove:function(e){for(var t,n,r=arguments,o=r.length;o>1&&e.length;)for(t=r[--o];-1!==(n=e.indexOf(t));)e.splice(n,1);return e}};return e}(),MENU=function(){var e={toggle:function(){document.querySelector("nav").classList.toggle("is-visible")}};return e}(),SCROLL=function(){var e={save:function(){var e=document.documentElement,t=(window.pageYOffset||e.scrollTop)-(e.clientTop||0);null!==document.querySelector("input[name=scroll_position]")&&(document.querySelector("input[name=scroll_position]").value=t)},toTop:function(){window.scrollTo({top:0,behavior:"smooth"})}};return e}(),BUTTON=function(){var e={add:function(e){document.querySelector("controls button[type=submit]").insertAdjacentHTML("afterend",e)},remove:function(){}};return e}(),FOLDER=function(){var e={deleteConfirm:function(e,t,n,r){e.preventDefault(),$content="Sicuro di voler eliminare "+r+"?",$action='<button class="btn red" onclick="FOLDER.delete(\''+t+"','"+n+"')\">"+ICON("trash")+"Elimina</button>",MODAL.open($content,$action)},delete:function(e,t){var n=new FormData;n.append("_MODULO",e),n.append("_FOLDER",t),axios({method:"POST",url:"ajax/folder-delete.php",data:n}).then(function(e){"OK"==e.data.trim()?window.location=window.location.href:alert(e.data)}).catch(function(e){alert("Folder delete: "+e.data)})},clone:function(e,t){var n=new FormData;n.append("_MODULO",e),n.append("_FOLDER",t),axios({method:"POST",url:"ajax/folder-clone.php",data:n}).then(function(e){"OK"==e.data.trim()?window.location=window.location.href:alert(e.data)}).catch(function(e){alert("Folder clone: "+e.data)})}};return e}(),files_dropped=!1,FILE=function(){var e={deleteConfirm:function(e,t){e.stopPropagation(),$content="Sicuro di voler eliminare questo file?",$action='<button class="btn red" onclick="FILE.delete(\''+t+"')\">"+ICON("trash")+"Elimina</button>",MODAL.open($content,$action)},delete:function(e){var t=new FormData;t.append("_FILE",e),axios({url:"ajax/file-delete.php",method:"POST",data:t}).then(function(t){"OK"==t.data.trim()?(document.querySelectorAll("[type=attachments]").forEach(function(t){$file_list=t.querySelector("input").value,$file_list=$file_list.split("|"),ARRAY.remove($file_list,e),t.querySelector("input").value=$file_list.join("|")}),document.getElementById("btn_save").click()):alert(t.data)}).catch(function(e){alert("File delete: "+e.data)})},get:function(e){var t=e,n=!0;if("images"!=t||document.getElementById("detail-images")||(n=!1),"documents"!=t||document.getElementById("detail-documents")||(n=!1),"choice_images"==t&&0==document.querySelectorAll("field[type=image]").length&&(n=!1),"choice_documents"==t&&0==document.querySelectorAll("field[type=document]").length&&(n=!1),"attachments"==t&&0==document.querySelectorAll("[type$='attachments']").length&&(n=!1),n)if("attachments"!=t){var r=new FormData;r.append("_TYPE",t),axios({url:"ajax/file-get.php",method:"POST",data:r}).then(function(e){switch(t){case"images":case"documents":document.getElementById("detail-"+t).innerHTML=e.data;break;case"choice_images":document.querySelectorAll("field[type=image] choices").forEach(function(t){t.innerHTML=e.data,$file_source=t.closest("field[type=image]").getAttribute("data-source"),$file_source&&(file_source_str=document.querySelector('input[name="'+$file_source+'"]').value,file_source_array=file_source_str.split("|"),t.querySelectorAll("choice").forEach(function(e){$file_name=e.querySelector("choice-value").innerText,-1==file_source_array.indexOf($file_name)&&e.parentNode.removeChild(e)}))});break;case"choice_documents":document.querySelectorAll("field[type=document] choices").forEach(function(t){t.innerHTML=e.data})}}).catch(function(e){alert("Files "+t+" get:"+e.data)})}else"attachments"==t&&document.querySelectorAll("[type$='attachments']").forEach(function(e){e.querySelector(".attachments-files").innerHTML="";var t=e.querySelector("input").value,n=e.getAttribute("type");if(void 0!==t&&""!=t){var r=new FormData;r.append("_ATTACHMENTTYPE",n),r.append("_FILELIST",t),axios({url:"ajax/file-get-attachments.php",method:"POST",data:r}).then(function(t){e.querySelector(".attachments-files").innerHTML=t.data}).catch(function(e){alert("File get attachments: "+e.data)})}else"readonly-attachments"==n&&(e.querySelector(".attachments-files").innerHTML="<i>Nessun file presente</i>")})},upload:function(e){let t=e.getAttribute("data-validation-file-type");if(document.querySelector("form").classList.contains("is-uploading"))return!1;PROGRESS.start(),document.querySelector("form").classList.add("is-uploading"),document.getElementById("dropzone")&&(dropzone.classList.add("is-visible"),dropzone_hover.classList.add("hidden"),dropzone_uploading.classList.remove("hidden"));var n=new FormData;if(n.append("anticsrf",UTIL.csrf()),files_dropped)for(var r=0;r<files_dropped.length;r++)n.append("file[]",files_dropped[r]);else for(var o=e.files.length,a=0;a<o;a++)n.append("file[]",e.files[a]);let i=e.closest("[type=attachments]");if(i){let e=i.querySelector("input[type=hidden]");e&&n.append("files__linked",e.value)}axios({method:"POST",url:"ajax/file-upload.php?type="+t,headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"multipart/form-data"},data:n}).then(function(t){e.value="",document.querySelector("form").classList.remove("is-uploading"),PROGRESS.done(),document.getElementById("dropzone")&&dropzone.classList.remove("is-visible"),$r=t.data.split("#"),$esito=$r[0],$content=$r[1],"OK"==$esito?(field_focus&&null!==field_focus.querySelector("input")&&(field_focus.querySelector("input").value=$content),document.getElementById("btn_save").click()):(dropzone.classList.remove("is-visible"),MODAL.open($content))}).catch(function(t){e.value="",PROGRESS.done(),document.getElementById("dropzone")&&dropzone.classList.remove("is-visible"),t="Si è verificato un errore. E' possibile che alcuni file pesino più di 4 Mb oppure riprovare più tardi.",MODAL.open(t)})}};return e}(),progressing=null,PROGRESS=function(){var e={start:function(){document.body.insertAdjacentHTML("beforeend",'<div id="progress"></div>'),progress_width=1,progressing=setInterval(function(){progress_width+=UTIL.rnd(1,10),progress_width>99?(clearInterval(progressing),progress.style.width="99%"):progress.style.width=progress_width+"%"},500)},done:function(){clearInterval(progressing),document.getElementById("progress")&&document.body.removeChild(progress)}};return e}(),MODAL=function(){var e={open:function(e,t,n){switch(t=t||"",n=n||"",n){case"success":modal_header.classList.add("success"),modal_header.innerHTML=ICON("check");break;case"error":modal_header.classList.add("error"),modal_header.innerHTML=ICON("x");break;case"relation":modal_window.classList.add("relation");break;case"calendar":modal_window.classList.add("calendar")}modal_content.innerHTML=e;var r=""==t?"":"ghost",o='<button onclick="MODAL.close()" class="btn '+r+'">'+ICON("x")+"Chiudi</button>";modal_footer.innerHTML=t+o,modal_container.classList.add("is-visible"),document.body.style.overFlow="hidden"},close:function(){modal_container.className="",modal_window.className="",modal_header.className="",modal_header.innerHTML="",modal_content.innerHTML="",modal_footer.innerHTML="",document.body.style.overFlow="auto"}};return e}(),SEARCH=function(){var e={display:function(){document.querySelector("nav").classList.remove("is-visible"),search.classList.add("is-visible")},reset:function(){searchField.value="",SEARCH.filter()},filter:function(){null!==document.querySelector("#list h3")&&($noresults=document.querySelector("#list h3"),$noresults.parentNode.removeChild($noresults)),document.querySelectorAll(".card").forEach(function(e){e.classList.remove("hidden")});var e=searchField.value.toLowerCase();if(e=STRING.clean(e),""==!e){var t=e.split(" ");document.querySelectorAll(".card").forEach(function(e){var n=[];if(null!==e.querySelector("card-tag")?(card_tag_array=[],e.querySelectorAll("card-tag").forEach(function(e){card_tag_array.push(STRING.clean(e.innerText.toLowerCase()))}),card_tag=card_tag_array.join()):card_tag="",null!==e.querySelector("card-hat")){let t=[];e.querySelectorAll("card-hat").forEach(function(e){t.push(STRING.clean(e.innerText.toLowerCase()))}),card_hat=t.join()}else card_hat="";null!==e.querySelector("card-title")?card_title=STRING.clean(e.querySelector("card-title").innerText.toLowerCase()):card_title="",t.forEach(function(e,t){card_tag.indexOf(e)>-1&&n.push(e),card_hat.indexOf(e)>-1&&n.push(e),card_title.indexOf(e)>-1&&n.push(e)}),n=ARRAY.unique(n),n.length<t.length&&e.classList.add("hidden")})}document.querySelectorAll(".card").length==document.querySelectorAll("a.card.hidden").length&&list.insertAdjacentHTML("beforeend","<h3>Nessun risultato.</h3>")}};return e}(),field_focus=null,FIELD=function(){var e={init:function(){let e=document.querySelectorAll("field[type=euro] input");e.forEach(e=>{e.addEventListener("change",function(t){e.value=e.value.replace(/\./g,",")})})},focus:function(e){field_focus=e.closest("[type=attachments]")}};return e}(),INPUT=function(){var e={reset:function(e){e.closest("field").querySelectorAll("input").forEach(function(e){e.value=""})}};return e}(),PASSWORD=function(){var e={switch:function(e){var t=e.closest("field[type=password]").querySelector("input");"password"===t.getAttribute("type")?(t.setAttribute("type","text"),e.querySelector("svg").innerHTML=ICON("eye-off")):(t.setAttribute("type","password"),e.querySelector("svg").innerHTML=ICON("eye"))}};return e}(),CHECK=function(){var e={toggle:function(e){let t=e.querySelector("input").value,n="0"==t?"1":"0",r=e.querySelector("svg"),o=document.createElement("template");o.innerHTML=ICON("1"===n?"check-square":"square");let a=o.content.childNodes[0];e.replaceChild(a,r),e.querySelector("input").value=n}};return e}(),choice_focus=null,CHOICE=function(){var e={toggle:function(e){e=e||window.event,e.preventDefault(),e.stopPropagation();var t=e.target||e.srcElement;choice_focus=t.closest("field").querySelector("choices"),choice_focus.classList.contains("is-visible")?CHOICE.hide():CHOICE.show()},show:function(){CHOICE.hide(),choice_focus.classList.add("is-visible")},hide:function(){document.querySelectorAll("choices").forEach(function(e){e.classList.remove("is-visible")})},set:function(e){var t=e.querySelector("choice-value");let n,r;t.hasAttribute("val")?(n=t.getAttribute("val"),r=t.innerText.trim()):(n=t.innerText.trim(),r=n);let o=e.closest("field"),a=o.querySelector("input[type=hidden]"),i=o.querySelector("input[type=text]");a&&(a.value=n),i&&(i.value=r),CHOICE.hide()}};return e}(),REPEATER=function(){var e={clone:function(e){var t=e.closest(".box").querySelector("repeater").innerHTML,n=document.createElement("repeater");n.innerHTML=t,n.querySelectorAll(".richtext-area").forEach(function(e){e.nextElementSibling.hasAttribute("data-default")?(richtext_default=e.nextElementSibling.getAttribute("data-default"),e.innerHTML=richtext_default):e.innerHTML=""}),n.querySelectorAll("input").forEach(function(e){e.hasAttribute("data-default")?(input_default=e.getAttribute("data-default"),e.value=input_default):e.value=""}),n.querySelectorAll("check").forEach(function(e){e.querySelector("input").hasAttribute("data-default")&&"1"==e.querySelector("input").getAttribute("data-default")?(e.querySelector("svg").innerHTML='<rect x="1" y="1" width="16" height="16" rx="2" ry="2"/><polyline points="5 9 8 12 14 5"/>',e.querySelector("input").value="1"):(e.querySelector("svg").innerHTML='<rect x="1" y="1" width="16" height="16" rx="2" ry="2"/><polyline style="display:none" points="5 9 8 12 14 5"/>',e.querySelector("input").value="0")}),n.querySelectorAll(".attachments-files").forEach(function(e){e.innerHTML=""}),e.closest(".box").querySelector("repeaters").appendChild(n),REPEATER.index()},delete:function(e){repeater_parent=e.closest("repeater"),repeater_parent.parentNode.removeChild(repeater_parent),REPEATER.index()},index:function(){document.querySelectorAll("repeaters").forEach(function(e){e.querySelectorAll("repeater").forEach(function(e,t){e.querySelectorAll("field").forEach(function(e){var n=e.querySelector("[name]"),r=n.getAttribute("name");void 0!==r&&(r=r.replace(/\[[0-9]*\]/g,"["+t+"]"),n.setAttribute("name",r))})})})}};return e}(),relation_focus=null,RELATION=function(){var e={display:function(e,t){relation_focus=e,axios({method:"POST",url:t+"-relation.php"}).then(function(e){var t="<relation>"+e.data+"</relation>";MODAL.open(t,"","relation")}).catch(function(e){alert("Relation:"+e.data)})},set:function(e,t){relation_focus.closest("field").querySelector("input[readonly]").value=t,relation_focus.closest("field").querySelector("input[type=hidden]").value=e,MODAL.close()}};return e}(),RICHTEXT=function(){var e={init:function(){document.querySelectorAll("field[type=richtext]").forEach(function(e){richtext_input=e.querySelector(".richtext-input").value,e.querySelector(".richtext-area").innerHTML=richtext_input}),setInterval(function(){document.querySelectorAll("field[type=richtext]").forEach(function(e){var t=e.querySelector(".richtext-area").innerHTML;$hCleaned=RICHTEXT.clean(t),e.querySelector(".richtext-input").value=$hCleaned})},1e3)},format:function(e,t){document.execCommand(e,!1,t)},deformatting:function(){document.execCommand("removeformat")},saveSelection:function(){if(window.getSelection){var e=window.getSelection();if(e.getRangeAt&&e.rangeCount)return e.getRangeAt(0)}else if(document.selection&&document.selection.createRange)return document.selection.createRange();return null},restoreSelection:function(e){if(e)if(window.getSelection){var t=window.getSelection();t.removeAllRanges(),t.addRange(e)}else document.selection&&e.select&&e.select()},writelink:function(){richtext_selection=RICHTEXT.saveSelection(),$content='<field class="full"><label>Inserisci il link:</label><input id="richtext_link" value="https://" type="text"></field>',$action='<button class="btn" onclick="RICHTEXT.insertLink()">'+ICON("link")+"Inserisci</button>",MODAL.open($content,$action)},insertLink:function(){RICHTEXT.restoreSelection(richtext_selection),RICHTEXT.format("createlink",richtext_link.value),MODAL.close()},empty:function(e){e.closest("field[type=richtext]").querySelector("div.richtext-area").innerHTML=""},clean:function(e){var t=/(\n|\r| class=(")?Mso[a-zA-Z]+(")?)/g,n=e.replace(t,""),r=new RegExp("<!--(.*?)-->","g");n=n.replace(r,"");var o=new RegExp("<(/)*(meta|link|span|\\?xml:|st1:|o:|font)(.*?)>","gi");n=n.replace(o,"");for(var a=["style","script","applet","embed","noframes","noscript"],i=0;i<a.length;i++)o=new RegExp("<"+a[i]+".*?"+a[i]+"(.*?)>","gi"),n=n.replace(o,"");var l=/ style="[^"]*"/gi;n=n.replace(l,"");var c=/ on\w+="[^"]*"/gi;return n=n.replace(c,""),n}};return e}(),ICON=function(){let e={},t=function(e){let t=ICONS_CONFIG._template,n=t.replace("{{icon}}",ICONS_CONFIG[e]);return n};return t.init=function(t){e=t},t}(),Weekdays=["Lun","Mar","Mer","Gio","Ven","Sab","Dom"],Months=["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],Today=new Date,D=Today.getDate(),M=Today.getMonth(),Y=Today.getFullYear(),Cal=new calendarBase.Calendar({siblingMonths:!0,weekStart:1}),CALENDAR=function(){var e={display:function(e){date_focus=e;var t="<calendar-header>";t+='<button onclick="CALENDAR.prevYear()" class="btn only--icon small">'+ICON("chevrons-left")+"</button>",t+='<button onclick="CALENDAR.prevMonth()" class="btn only--icon small">'+ICON("chevron-left")+"</button>",t+="<h5>"+Months[M]+"&#160;"+Y+"</h5>",t+='<button onclick="CALENDAR.nextMonth()" class="btn only--icon small">'+ICON("chevron-right")+"</button>",t+='<button onclick="CALENDAR.nextYear()" class="btn only--icon small">'+ICON("chevrons-right")+"</button>",t+="</calendar-header>",t+='<ul class="calendar">',Weekdays.forEach(function(e){t+='<li class="day weekday">'+e+"</li>"}),Cal.getCalendar(Y,M).forEach(function(e){var n=["day"];e.siblingMonth&&n.push("is-sibling"),e.day==Today.getDate()&&e.month==Today.getMonth()&&e.year==Today.getFullYear()&&n.push("is-today"),d=STRING.pad(e.day,2),m=STRING.pad(e.month+1,2),y=e.year;var r=d+"/"+m+"/"+y;t+='<li class="'+n.join(" ")+'" onclick="CALENDAR.setDate(\''+r+"')\">",t+='<img src="assets/img/day.gif" />',t+="<p>"+e.day+"</p>",t+="</li>"}),t+="</ul>",MODAL.open(t,"","calendar")},prevYear:function(){Y-=1,CALENDAR.display(date_focus)},prevMonth:function(){0==M?(M=11,Y-=1):M-=1,CALENDAR.display(date_focus)},nextMonth:function(){11==M?(M=0,Y+=1):M+=1,CALENDAR.display(date_focus)},nextYear:function(){Y+=1,CALENDAR.display(date_focus)},setDate:function(e){date_focus.closest("field").querySelector("input").value=e,MODAL.close()}};return e}();FIELD.init(),RICHTEXT.init(),document.querySelector("main")&&(document.querySelector("main").style.paddingBottom=document.querySelector("controls").offsetHeight+16+"px"),FILE.get("images"),FILE.get("choice_images"),FILE.get("documents"),FILE.get("choice_documents"),FILE.get("attachments"),document.body.onscroll=SCROLL.save;